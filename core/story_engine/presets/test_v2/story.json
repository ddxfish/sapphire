{
  "name": "State Engine Test v2",
  "description": "Test preset for refactored state engine with state_key choices and riddles.",
  "initial_state": {
    "scene": {
      "value": 1,
      "type": "integer",
      "label": "Scene",
      "min": 1,
      "max": 4,
      "adjacent": 1
    },
    "gold": {
      "value": 100,
      "type": "integer",
      "label": "Gold",
      "min": 0
    },
    "health": {
      "value": 10,
      "type": "integer",
      "label": "Health",
      "min": 0,
      "max": 10
    },
    "bridge_choice": {
      "value": null,
      "type": "choice",
      "label": "Bridge Decision",
      "visible_from": 1
    },
    "vault_code": {
      "value": null,
      "type": "riddle_answer",
      "label": "Vault Code",
      "visible_from": 3
    },
    "vault_opened": {
      "value": false,
      "type": "boolean",
      "label": "Vault Opened",
      "visible_from": 3
    }
  },
  "binary_choices": [
    {
      "id": "bridge",
      "state_key": "bridge_choice",
      "trigger_turn": 0,
      "prompt": "The bridge ahead looks unstable. Do you cross carefully or find another way?",
      "options": {
        "cross": {
          "description": "Cross the rickety bridge (risky but fast)",
          "set": {
            "health": "-2"
          }
        },
        "detour": {
          "description": "Take the long way around (safe but costs gold)",
          "set": {
            "gold": "-20"
          }
        }
      },
      "required_for_scene": 2,
      "block_message": "You must decide how to cross before continuing! Use set_state(\"bridge_choice\", \"cross\") or set_state(\"bridge_choice\", \"detour\")"
    }
  ],
  "riddles": [
    {
      "id": "vault",
      "state_key": "vault_code",
      "name": "The Vault",
      "type": "fixed",
      "answer": "1234",
      "digits": 4,
      "visible_from_scene": 3,
      "max_attempts": 3,
      "clues": {
        "1": "The code is 4 digits long.",
        "2?scene_turns>=1": "Each digit increases by one.",
        "3?scene_turns>=3": "It starts with 1."
      },
      "success_sets": {
        "vault_opened": true
      },
      "lockout_sets": {},
      "success_message": "The vault clicks open! You may now advance to see what's inside.",
      "fail_message": "Wrong code. The vault beeps angrily.",
      "lockout_message": "The vault seals permanently. Whatever was inside is lost forever."
    }
  ],
  "progressive_prompt": {
    "iterator": "scene",
    "mode": "cumulative",
    "base": "You are a dungeon master running a simple adventure.\n\nYour job is to narrate the story and use tools to track state.\nLet the player guide their actions, then reflect those in state changes.\n\n**Tools:** get_state(), set_state(key, value, reason), advance_scene(reason), roll_dice(count, sides)\n\n**IMPORTANT:** When you see a choice key with [not set], you MUST use set_state to set it before you can advance_scene. Check the options shown in the state table.",
    "segments": {
      "1": "\n\n## Scene 1: The Bridge\n\nThe adventurer stands at a rickety rope bridge spanning a deep chasm.\n\n**DM Notes:** The player must choose how to cross. You CANNOT call advance_scene until bridge_choice is set.\n- If they want to cross: set_state(\"bridge_choice\", \"cross\", \"reason\") - costs 2 health\n- If they want to go around: set_state(\"bridge_choice\", \"detour\", \"reason\") - costs 20 gold\n\nDo NOT roll dice for this - the choice handles the cost automatically.",

      "2": "\n\n## Scene 2: The Path\n\nPast the bridge obstacle, the path winds deeper into the mountain.\n\n**DM Notes:** Describe the journey based on what happened:\n- If bridge_choice = \"cross\": They took 2 damage crossing\n- If bridge_choice = \"detour\": They spent 20 gold on the long way\n\nNarrate a brief journey, then advance_scene when ready.",

      "3": "\n\n## Scene 3: The Vault\n\nA massive vault door blocks the way forward. A keypad awaits input.\n\n**DM Notes:** The vault_code riddle is now active. Work with the player to solve it using the clues.\n- When they want to try a code: set_state(\"vault_code\", \"XXXX\", \"reason\")\n- If correct: vault_opened becomes true, then advance_scene to see the treasure\n- If wrong: they lose an attempt\n- You CANNOT advance_scene until vault_opened = true",

      "3?vault_opened": "\n\n**The vault is OPEN!** You may now advance_scene to see what's inside.",

      "4": "\n\n## Scene 4: The Treasure\n\nThe vault swings open to reveal... a small pedestal with a handwritten note.\n\nThe note reads:\n\n*\"The greatest treasure is not gold or gems, but the journey itself and the companions who share it. The real reward was the adventure you just had.\"*\n\n**DM Notes:** This is the ending. Narrate the conclusion based on the journey:\n- How much health/gold do they have left?\n- Did they take risks (cross) or play it safe (detour)?\n- How many riddle attempts did it take?\n\nCongratulate the player on completing the adventure!"
    }
  }
}