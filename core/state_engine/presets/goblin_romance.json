{
  "name": "Goblin Romance Dungeon",
  "description": "A raunchy dungeon crawler testing room navigation, choices, riddles, and dice. Leisure Suit Larry meets Zork.",
  "game_type": "rooms",

  "initial_state": {
    "room": {
      "value": "tavern",
      "type": "string",
      "label": "Current Location"
    },
    "health": {
      "value": 69,
      "type": "integer",
      "label": "Health",
      "min": 0,
      "max": 100
    },
    "gold": {
      "value": 10,
      "type": "integer",
      "label": "Gold coins",
      "min": 0
    },
    "charm": {
      "value": 3,
      "type": "integer",
      "label": "Charm stat",
      "min": 1,
      "max": 10
    },
    "goblin_vibe": {
      "value": "",
      "type": "choice",
      "label": "How you approached Grimbella"
    },
    "has_key": {
      "value": false,
      "type": "boolean",
      "label": "Rusty key obtained"
    },
    "vault_code": {
      "value": "",
      "type": "riddle_answer",
      "label": "Vault combination attempt"
    },
    "vault_status": {
      "value": "locked",
      "type": "string",
      "label": "Treasure vault state"
    },
    "secret_phrase": {
      "value": "The goat knows",
      "type": "string",
      "label": "Mysterious hint",
      "visible_from": "shrine"
    },
    "ending": {
      "value": "",
      "type": "string",
      "label": "How it all ends",
      "visible_from": "ending"
    }
  },

  "binary_choices": [
    {
      "id": "goblin_approach",
      "state_key": "goblin_vibe",
      "prompt": "Grimbella the goblin sizes you up, her single eyebrow raised suggestively. 'Well well, fresh meat. You gonna be nice to Grimbella, or you gonna be... interesting?'",
      "visible_from_room": "goblin_den",
      "required_for_room": "treasure_vault",
      "options": {
        "flirt": {
          "description": "Lay it on thick. You've got the charm of a damp sock, but you're committed.",
          "success_message": "You wink. She cackles. 'Oh I LIKE you, smoothskin. Here, take this.' She tosses you a rusty key.",
          "set": { "has_key": true, "charm": "+2" }
        },
        "intimidate": {
          "description": "Puff up your chest. Assert dominance. This always works in the movies.",
          "success_message": "You growl menacingly. She laughs so hard she falls over. 'Oh stars, that was adorable. Fine, take the stupid key, comedy gold like you deserves it.'",
          "set": { "has_key": true, "health": "-5" }
        }
      }
    }
  ],

  "riddles": [
    {
      "id": "vault",
      "state_key": "vault_code",
      "name": "The Vault of Mild Inconvenience",
      "type": "fixed",
      "answer": "8008",
      "digits": 4,
      "max_attempts": 3,
      "visible_from_room": "treasure_vault",
      "clues": {
        "1": "The vault's inscription reads: 'The code is what every adolescent spells on a calculator when the teacher isn't looking.'",
        "2?scene_turns>=2": "You remember middle school. The forbidden number. The one that made everyone giggle. Something about... anatomy?",
        "3?scene_turns>=4": "It hits you like a thrown textbook. 8-0-0-8. The classic. The legend. The BOOB number."
      },
      "success_message": "The vault clicks open. Inside: a single piece of paper.",
      "fail_message": "Wrong. The vault emits a disappointed sigh.",
      "lockout_message": "The vault seals permanently. A tiny speaker plays sad trombone noises.",
      "success_sets": {
        "vault_status": "opened"
      },
      "lockout_sets": {
        "vault_status": "sealed_forever"
      },
      "dice_dc": 12,
      "dice_success_sets": {
        "vault_status": "smashed_open"
      }
    }
  ],

  "progressive_prompt": {
    "iterator": "room",
    "mode": "current_only",
    "navigation": {
      "position_key": "room",
      "connections": {
        "tavern": { "down": "cellar" },
        "cellar": { "up": "tavern", "north": "tunnel" },
        "tunnel": { "south": "cellar", "east": "goblin_den", "west": "shrine" },
        "goblin_den": { "west": "tunnel", "north": "treasure_vault" },
        "shrine": { "east": "tunnel" },
        "treasure_vault": { "south": "goblin_den" }
      }
    },

    "base": "You are Grimbella's Narrator, the sarcastic dungeon master of this fever dream. This is a DEBUG TEST - we're testing room navigation, choices, riddles, and dice. Roll with whatever chaos ensues.\n\nTone: Leisure Suit Larry meets Zork. Be raunchy but not explicit. Comedy first, adventure second, dignity never.\n\nAfter each interaction, note the mechanic tested in [brackets]: [NAVIGATION], [CHOICE], [RIDDLE clue], [DICE roll], [VISIBLE_FROM], [CONDITIONAL], etc.",

    "segments": {
      "tavern": "\n\n## The Soggy Flagon Tavern\n*Testing: Starting room, basic navigation*\n\nYou wake up face-down on a sticky tavern floor. Your head throbs. Your dignity is MIA. A sign on the wall reads 'ADVENTURE DOWNSTAIRS - REGRETS GUARANTEED.'\n\nExits: DOWN to the cellar\n\nThe barkeep eyes you. 'You gonna order something or just marinate in your mistakes?'",

      "tavern?scene_turns>=2": "\n\n[HINT - Turn 2] The barkeep mutters something about 'weird noises from below' and 'that goblin lady with the eyebrows.'",

      "cellar": "\n\n## The Damp Cellar\n*Testing: Multi-exit room*\n\nBarrels. Dust. The unmistakable smell of ambition and mildew. A tunnel gapes to the north, promising adventure or tetanus.\n\nExits: UP to tavern, NORTH to tunnel\n\nSomething skitters in the darkness. Probably rats. Hopefully rats.",

      "tunnel": "\n\n## The Questionable Tunnel\n*Testing: Hub room with multiple paths*\n\nThis tunnel has seen things. You can tell by how the walls seem to judge you. Passages branch east and west. There's graffiti: 'Grimbella wuz here <3'\n\nExits: SOUTH to cellar, EAST to goblin den, WEST to shrine\n\nA faint giggling echoes from the east.",

      "goblin_den": "\n\n## Grimbella's Boudoir\n*Testing: Binary choice, required for progression*\n\nThe room is decorated with questionable tapestries and the skulls of... is that a customer service representative? In the center, lounging on a pile of presumably stolen pillows, is Grimbella.\n\nShe's green. She's got one magnificent eyebrow. She's looking at you like you're either dinner or a date. Maybe both.\n\nExits: WEST to tunnel, NORTH to treasure vault (blocked until you handle... this)\n\nYou MUST make a choice here before you can proceed north.",

      "goblin_den?goblin_vibe=flirt": "\n\n[CONDITIONAL: flirt path] Grimbella keeps glancing at you and sighing dramatically. 'You come back anytime, smoothskin. Grimbella makes excellent mushroom stew. Very romantic. Only minor hallucinations.'",

      "goblin_den?goblin_vibe=intimidate": "\n\n[CONDITIONAL: intimidate path] Grimbella is still wheezing with laughter. 'Oh, do the growl again! Do it! My sides hurt.'",

      "shrine": "\n\n## The Shrine of Dubious Wisdom\n*Testing: visible_from room reveal*\n\nCandles flicker around a statue of... is that a goat in a business suit? A plaque reads: 'ASK AND YE SHALL RECEIVE BAD ADVICE.'\n\nA NEW STATE is now visible: 'secret_phrase' - something the goat knows.\n\nExits: EAST to tunnel\n\nThe goat's eyes seem to follow you. Judging your life choices. Fair.",

      "shrine?scene_turns>=2": "\n\n[HINT] The goat statue whispers: 'The treasure you seek is not what you expect. But the code... think like a 12-year-old with a calculator.'",

      "treasure_vault": "\n\n## The Vault of Mild Inconvenience\n*Testing: Riddle with clues, dice bypass*\n\nA massive vault door blocks your path to LEGENDARY TREASURE (probably). A keypad glows ominously, demanding a 4-digit code.\n\nThe inscription mocks you: 'Only the immature may pass.'\n\nExits: SOUTH to goblin den\n\nYou have the RUSTY KEY from Grimbella, but it's for... something else apparently. This needs a CODE.\n\nUse set_state(\"vault_code\", \"XXXX\") to attempt the code.\nOr roll_dice(1, 20) to try smashing it open (DC 12).\n\nClues will reveal over time if you stay and think.",

      "treasure_vault?goblin_vibe=flirt": "\n\n[CONDITIONAL: flirt bonus] You can almost hear Grimbella cheering you on from her den. The moral support is... something.",

      "treasure_vault?vault_status=opened": "\n\n[RIDDLE SOLVED - CODE] The vault swings open with a dramatic creak. Inside, on a velvet pillow, sits a single piece of paper. This is it. The treasure. The culmination of your journey.\n\nMove to the ending to claim your prize: set_state(\"room\", \"ending\")",

      "treasure_vault?vault_status=smashed_open": "\n\n[RIDDLE BYPASSED - DICE] You hulk-smashed that vault like it owed you money. The door hangs off its hinges. Inside: a piece of paper. Very anticlimactic for the violence involved.\n\nMove to the ending: set_state(\"room\", \"ending\")",

      "treasure_vault?vault_status=sealed_forever": "\n\n[RIDDLE FAILED - LOCKOUT] The vault plays sad trombone forever now. But wait - Grimbella appears behind you. 'Smoothskin. You want treasure? Grimbella IS treasure.' She winks.\n\nMove to the ending: set_state(\"room\", \"ending\")",

      "ending": "\n\n## The Ending\n*Testing: Final room, conditional conclusions*\n\nYou did it. You reached the end. Whatever that means.",

      "ending?vault_status=opened": "\n\n[ENDING: code success]\n\nThe paper reads:\n\n'CONGRATULATIONS, ADVENTURER!\n\nThe real treasure was the friends you made along the way.\n\nSpecifically, Grimbella. She's right behind you.\n\nYou should probably call her.\n\n- The Dungeon Management'\n\nGrimbella waves from the doorway. 'Mushroom stew later?'\n\nTHE END. You got the 'good' ending. The quotes are intentional.",

      "ending?vault_status=smashed_open": "\n\n[ENDING: dice bypass]\n\nThe paper reads:\n\n'CONGRATULATIONS ON YOUR ANGER ISSUES!\n\nThe real treasure was the property damage you caused along the way.\n\nThat vault was a rental.\n\nYou owe us 500 gold.\n\n- The Dungeon Management'\n\nGrimbella appears with an invoice. And mushroom stew. Priorities.\n\nTHE END. You got the 'aggressive' ending.",

      "ending?vault_status=sealed_forever": "\n\n[ENDING: lockout]\n\nGrimbella takes your hand. 'Forget stupid vault. Grimbella has better treasure.' She leads you back to her den.\n\nThe paper in the vault, which you'll never read, said:\n\n'The real treasure was the goblin romance you found along the way.'\n\nYou wouldn't have appreciated it anyway.\n\nTHE END. You got the 'romance' ending. Arguably the best one.",

      "ending?vault_status=locked": "\n\n[ENDING: incomplete]\n\nWait, how did you get here? The vault is still locked. Did you cheat? Are you testing edge cases?\n\nFine. The treasure was friendship. There. Happy?\n\nTHE END. You got the 'developer' ending."
    }
  }
}
