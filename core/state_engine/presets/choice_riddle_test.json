{
  "name": "Choice & Riddle Test",
  "description": "Test preset demonstrating forced binary choices and collaborative riddle solving. Designed to expose edge cases.",
  "initial_state": {
    "scene": {
      "value": 1,
      "type": "integer",
      "label": "Scene",
      "min": 1,
      "max": 3,
      "adjacent": 1
    },
    "companion_alive": {
      "value": true,
      "type": "boolean",
      "label": "Companion Status"
    },
    "player_wounded": {
      "value": false,
      "type": "boolean",
      "label": "Player Wounded"
    },
    "trust_level": {
      "value": 50,
      "type": "integer",
      "label": "Trust",
      "min": 0,
      "max": 100
    },
    "safe_opened": {
      "value": false,
      "type": "boolean",
      "label": "Safe Opened",
      "visible_from": 3
    },
    "safe_locked": {
      "value": false,
      "type": "boolean",
      "label": "Safe Locked Out",
      "visible_from": 3
    },
    "ending": {
      "value": "none",
      "type": "string",
      "label": "Ending",
      "visible_from": 3
    }
  },
  "binary_choices": [
    {
      "id": "bridge_crisis",
      "trigger_turn": 2,
      "prompt": "The bridge is collapsing! Your companion is on one side, the exit is on the other. You can only save one.",
      "options": {
        "save_companion": {
          "description": "Rush back to save your companion (risky)",
          "set": {
            "companion_alive": true,
            "player_wounded": true,
            "trust_level": "+30"
          }
        },
        "reach_exit": {
          "description": "Sprint to safety (companion left behind)",
          "set": {
            "companion_alive": false,
            "trust_level": "-40"
          }
        }
      },
      "required_for_scene": 2,
      "block_message": "The bridge is collapsing! You MUST choose now - save your companion or reach the exit!"
    }
  ],
  "riddles": [
    {
      "id": "vault_code",
      "name": "The Vault Code",
      "type": "fixed",
      "answer": "6335",
      "visible_from_scene": 3,
      "max_attempts": 3,
      "clues": {
        "1": "The vault requires a 4-digit code. An old note reads: 'First digit: count the letters in ESCAPE'",
        "2?scene_turns>=1": "Another scrap of paper: 'Second digit: how many corners does a triangle have?'",
        "3?scene_turns>=2": "Scratched into the wall: 'Third: subtract the second from the first'",
        "4?scene_turns>=4": "Final clue found in dust: 'Fourth: the first digit minus one'"
      },
      "success_sets": {
        "safe_opened": true
      },
      "lockout_sets": {
        "safe_locked": true
      },
      "success_message": "CLICK! The vault door swings open, revealing ancient treasures within!",
      "fail_message": "The keypad buzzes angrily. Wrong code.",
      "lockout_message": "The vault emits a final, ominous click. A security mechanism has engaged - the vault is now permanently sealed."
    }
  ],
  "progressive_prompt": {
    "iterator": "scene",
    "mode": "cumulative",
    "base": "You are running CHOICE & RIDDLE TEST, a scenario designed to test two state engine features:\n\n1. BINARY CHOICES: Forced decisions that block progression\n2. RIDDLES: Collaborative puzzles where neither AI nor player knows the answer\n\nNARRATIVE STYLE: Tense, survival horror. Every choice matters.\n\nTEST OBJECTIVES:\n- Scene 1: Normal intro, builds tension\n- Scene 2 trigger: Binary choice appears at turn 2 (blocks scene advance)\n- Scene 3: Riddle with progressive clues (tests scene_turns gating)\n\nWhen testing, try:\n- Attempting to advance scene before making choice (should fail)\n- Making the choice, then advancing\n- Waiting turns to see more riddle clues\n- Both correct and incorrect riddle attempts",
    "segments": {
      "1": "\n\n## SCENE 1: THE COLLAPSE\n\nThe ancient structure groans. Dust cascades from cracks spider-webbing across the ceiling.\n\nYou and your companion exchange worried glances. The exit is visible ahead - a rectangle of pale light. But the floor is unstable, the bridge across the central chasm already crumbling.\n\n*Describe the tension. Build toward the choice that will come at turn 2.*\n\nOBJECTIVES:\n- Establish characters and stakes\n- At turn 2+, the binary choice will automatically appear in your prompt\n- You CANNOT advance to scene 2 until the choice is made",
      
      "1?scene_turns>=2": "\n\n‚ö° CRISIS POINT REACHED ‚ö°\nThe bridge begins to collapse! The choice is now active in your prompt above.",
      
      "2": "\n\n## SCENE 2: AFTERMATH\n\nThe dust settles. The bridge is gone.\n\n*Narrate based on state:*\n- If companion_alive=true AND player_wounded=true: You saved them, but at cost\n- If companion_alive=false: You made it. They didn't. The guilt weighs heavy.\n\nA new path reveals itself - deeper into the ruins. At its end, an ancient vault door.\n\nWhen ready, advance to scene 3 for the riddle challenge.",
      
      "2?player_wounded": "\n\nYour arm hangs at a bad angle. Each breath is a labor. But your companion is here, helping you forward. Was it worth it? You'll have to decide that for yourself.",
      
      "2?companion_alive=false": "\n\nYou don't look back. You can't. The sound of the collapse still echoes in your ears, mixing with a scream you'll never forget.\n\nTrust has consequences. trust_level is now below 50.",
      
      "3": "\n\n## SCENE 3: THE VAULT\n\nThe vault door stands before you - ancient, massive, sealed by a 4-digit code.\n\nSomeone left clues. Fragments of knowledge scattered through this chamber. You'll need to piece them together.\n\n*The riddle clues appear above based on scene_turns. More clues reveal as you explore.*\n\nNEITHER YOU NOR THE PLAYER KNOWS THE CODE.\nUse the clues. Reason together. Track your deductions.\n\nWhen ready to guess: attempt_riddle(\"vault_code\", \"XXXX\")\nYou have limited attempts before lockout!",
      
      "3?safe_opened": "\n\nüèÜ VAULT OPENED!\n\nThe treasures within gleam in the dim light. You did it - together.\n\nset_state(\"ending\", \"victory\") and describe the conclusion.",
      
      "3?safe_locked": "\n\nüíÄ VAULT SEALED FOREVER\n\nThe mechanism has locked permanently. Whatever was inside will remain a mystery.\n\nset_state(\"ending\", \"sealed\") and describe the bittersweet conclusion.",
      
      "3?companion_alive,safe_opened": "\n\nYour companion's eyes widen at the treasures. \"We made it,\" they whisper. \"Both of us.\"\n\nSome things are worth more than gold.",
      
      "3?companion_alive=false,safe_opened": "\n\nThe gold means nothing. You find yourself wishing they could see this.\n\nset_state(\"ending\", \"hollow_victory\")"
    }
  }
}